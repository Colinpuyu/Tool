export const PRD_CONTENT = `# 项目需求文档：项目围挡清单计算系统 (Construction Enclosure Calculator)

**版本号**: 1.0
**更新日期**: 2023-10-27
**适用对象**: 前端开发工程师、全栈开发工程师、产品经理

---

## 1. 项目概述 (Project Overview)

### 1.1 产品背景
在建筑施工项目中，围挡建设需要根据场地尺寸（长、宽）和封闭状态计算多种建材（如洞洞板、立杆、螺栓等）的用量。传统的 Excel 计算方式不够直观且难以合并统计。本系统旨在提供一个基于 Web 的、可自定义计算规则的材料清单计算工具。

### 1.2 产品目标
*   提供直观的参数录入界面，实时计算材料用量。
*   支持**动态配置计算公式**，用户可根据项目需求修改计算逻辑（类似 Excel 公式）。
*   支持清单的汇总、导出（CSV）。
*   提供生成离线桌面版（Python Script）的功能，方便无网环境使用。

---

## 2. 功能需求 (Functional Requirements)

### 2.1 核心计算与录入模块 (Input & Calculation)
**用户故事**: 用户输入场地尺寸参数，系统自动根据预设规则计算各项材料数量，并添加到清单中。

1.  **参数录入**:
    *   **工种/区域名称** (Type): 文本输入，必填。
    *   **长度** (Length, \`L\`): 数值，单位米，必填。
    *   **宽度** (Width, \`W\`): 数值，单位米，必填。
    *   **是否封闭** (Is Enclosed, \`D\`): 布尔值 (Checkbox)。
        *   选中（是）对应数值 \`1\`。
        *   未选中（否）对应数值 \`0\`。
2.  **实时预览**:
    *   在将数据添加到列表前，界面需展示核心规则（如前 5 项）的计算结果预览。
3.  **计算引擎**:
    *   系统需内置一个动态计算引擎，能够解析用户定义的公式字符串。
    *   支持的数学函数: \`MAX\`, \`MIN\`, \`INT\` (向下取整), \`CEIL\` (向上取整), \`ABS\` (绝对值), \`ROUND\` (四舍五入)。
    *   上下文变量: \`L\` (长), \`W\` (宽), \`D\` (封闭状态)。
    *   **依赖引用**: 后续的计算规则可以引用之前已计算出的规则结果（例如：\`螺母\` 的公式可以引用 \`螺栓\` 的计算结果）。

### 2.2 清单管理模块 (List Management)
**用户故事**: 用户需要查看已添加的所有项目，并进行删改或导出。

1.  **数据列表**:
    *   以表格形式展示所有已添加的项目。
    *   **动态列**: 表格的列头不是固定的，而是根据当前的“计算规则配置”动态生成的。
2.  **操作功能**:
    *   **添加**: 点击“添加到清单”将当前输入参数及计算结果存入列表。
    *   **删除单行**: 每行数据后需提供删除按钮。
    *   **清空**: 提供一键清空所有数据的功能（需二次确认）。
3.  **合计统计**:
    *   表格底部需固定展示“合计”行，自动累加每一列的数值。
4.  **数据导出**:
    *   支持导出为 CSV 格式。
    *   文件名包含日期。
    *   CSV 内容必须包含 BOM 头 (\`\\uFEFF\`) 以解决 Excel 打开中文乱码问题。

### 2.3 规则配置系统 (Settings & Templates)
**用户故事**: 默认的计算公式可能不适用所有项目，用户需要修改公式、添加新材料列或导入同事分享的模版。

1.  **规则编辑**:
    *   支持对计算规则进行 CRUD（增删改查）操作。
    *   **字段定义**:
        *   \`ID\` (变量名): 必须是合法的 JavaScript 变量名（字母、数字、下划线，不能以数字开头）。**必须进行正则校验，非法 ID 禁止保存**。
        *   \`Label\` (显示名称): 表格列头显示的文字（如“M10*40 螺栓”）。
        *   \`Formula\` (公式): JavaScript 表达式字符串（如 \`(L+W)*2\`）。
2.  **模版管理**:
    *   **恢复默认**: 一键重置为系统内置的初始规则（需二次确认）。
    *   **导出模版**: 将当前所有规则导出为 JSON 文件。
    *   **导入模版**: 上传 JSON 文件覆盖当前规则。
3.  **内置默认规则** (参照 Excel 逻辑):
    *   系统需硬编码一套默认规则。

### 2.4 桌面版生成器 (Python Generator)
**用户故事**: 某些工地现场没有网络，用户希望获得一个能在本地运行的类似软件。

1.  **代码生成**:
    *   前端动态生成一段 Python 代码 (\`tkinter\` GUI 库)。
    *   该 Python 代码的逻辑必须与当前 Web 版的**默认逻辑**保持一致。
2.  **指引展示**:
    *   弹窗展示 Python 源码。
    *   提供“复制”和“下载 .py 文件”按钮。
    *   提供简单的教程，指导用户如何安装 Python 及使用 \`pyinstaller\` 打包成 \`.exe\` 文件。

---

## 3. 算法与数据逻辑 (Algorithm Logic)

### 3.1 变量定义
*   \`L\`: 输入的长度。
*   \`W\`: 输入的宽度。
*   \`D\`: 输入的封闭状态 (1 或 0)。

### 3.2 默认计算规则 (Initial Rules)
系统初始化时应包含以下规则（按顺序计算，后续规则可引用前者）：

| 顺序 | ID (变量名) | 显示名称 | 逻辑描述/公式 |
| :--- | :--- | :--- | :--- |
| 1 | \`plate\` | 洞洞板1 | 封闭 ? (L+W)*2-2 : (L+W)*2-MAX(L,W) |
| 2 | \`pole1\` | 竖杆1 | 封闭 ? 4 : 2 |
| 3 | \`midPole\` | 中间杆 | (L>3 ? INT((L-1)/2)*2 : 0) + (W>3 ? INT((W-1)/2)*2 : 0) - (封闭 ? 0 : INT((MAX(L,W)-1)/2)) |
| 4 | \`openPole\`| 开放立杆 | 封闭 ? 0 : 1 |
| 5 | \`doorFrame\`| 门框 | 封闭 ? 1 : 0 |
| 6 | \`wall\` | 一体墙 | 固定值 1 |
| 7 | \`rib1\` | 加强筋 | 封闭 ? ((L+W-2)*2 - midPole - doorFrame) : ((L+W-2)*2 - midPole - (MAX(L,W)-1)) |
| 8 | \`rib2\` | 加强筋2 | 等于 midPole |
| 9 | \`ribL\` | L型筋 | 封闭 ? 3 : 2 |
| 10 | \`bolt40\` | M10*40 | pole1 * 8 |
| 11 | \`bolt60\` | M10*60 | 复杂逻辑，见代码 (基于周长、midPole、MAX等计算) |
| 12 | \`bolt100\`| M10*100 | midPole * 4 |
| 13 | \`nut\` | 螺母 | bolt40 + bolt60 + bolt100 |
| 14 | \`screw\` | 燕尾丝 | (rib1 + rib2 + ribL) * 6 |

### 3.3 安全性要求 (Security Requirement)
由于使用了动态执行代码（类似 \`eval\` 或 \`new Function\`）：
1.  在执行 \`new Function\` 前，**必须过滤上下文对象（Context）**。
2.  仅允许传递符合 JS 变量命名规范 (\`/^[a-zA-Z_$][a-zA-Z0-9_$]*$/\`) 的 Key 进入执行环境。
3.  防止用户定义的非法 ID 导致系统崩溃（如 ID 为 \`field-1\` 会导致语法错误）。

---

## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 技术栈
*   **前端框架**: React 18+ (使用 Hooks).
*   **语言**: TypeScript.
*   **样式库**: Tailwind CSS.
*   **图标库**: Lucide React.

### 4.2 性能与兼容性
*   **响应式设计**: 必须适配 PC 端（左右分栏）和 移动端（上下堆叠）。
*   **浏览器兼容**: Chrome, Edge, Safari, Firefox 最新版。
`;

export const downloadPRD = () => {
  const blob = new Blob([PRD_CONTENT], { type: 'text/markdown;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = '项目围挡清单计算系统_需求文档_v1.0.md';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};